#!/usr/bin/env bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

if ! command -v antlr4 &> /dev/null && ! command -v antlr &> /dev/null; then
    echo "Error: ANTLR is not installed or not in PATH." >&2
    echo "Please install ANTLR." >&2
    exit 1
else
    ANTLR_CMD="antlr4"
    if ! command -v antlr4 &> /dev/null; then
        ANTLR_CMD="antlr"
    fi

    echo "Generating parser from grammar..."
    cd "$PROJECT_ROOT/grammar"
    $ANTLR_CMD -Dlanguage=JavaScript IconScript.g4
    cd "$PROJECT_ROOT"
fi

exit 0